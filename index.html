<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>–ê–≥–Ω–∏—è–ö–æ–º–±–∞—Ç27</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --tg-theme-bg-color: #6a11cb;
            --tg-theme-text-color: #ffffff;
            --tg-theme-button-color: #ff6b6b;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: rgba(255, 255, 255, 0.1);
            --tg-theme-hint-color: #aaaaaa;
            --tg-theme-link-color: #2575fc;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, var(--tg-theme-bg-color, #6a11cb) 0%, var(--tg-theme-link-color, #2575fc) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--tg-theme-text-color, #ffffff);
            overflow-x: hidden;
            transition: background 0.3s ease;
        }

        .container {
            text-align: center;
            background: var(--tg-theme-secondary-bg-color, rgba(255, 255, 255, 0.1));
            backdrop-filter: blur(12px);
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 500px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transform: rotate(0deg);
            z-index: -1;
        }

        .title {
            font-family: 'Montserrat', sans-serif;
            font-size: 3rem;
            font-weight: 900;
            color: var(--tg-theme-text-color, #ffffff);
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4);
            margin-bottom: 30px;
            letter-spacing: 2px;
            position: relative;
            display: inline-block;
            animation: titleGlow 2s infinite alternate;
        }

        @keyframes titleGlow {
            0% {
                text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4), 0 0 0 rgba(255, 255, 255, 0.5);
            }
            100% {
                text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4), 0 0 20px rgba(255, 255, 255, 0.8);
            }
        }

        .counter {
            font-size: 3rem;
            color: var(--tg-theme-text-color, #ffffff);
            margin: 30px 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .click-button {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: linear-gradient(145deg, var(--tg-theme-button-color, #ff6b6b), #ff8e8e);
            border: none;
            color: var(--tg-theme-button-text-color, #ffffff);
            font-size: 1.6rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.5);
            position: relative;
            overflow: hidden;
            margin: 20px 0;
        }

        .click-button:hover {
            transform: scale(1.08);
            box-shadow: 0 15px 30px rgba(255, 107, 107, 0.7);
        }

        .click-button:active {
            transform: scale(0.95);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .click-button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 60%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .click-button:hover::before {
            opacity: 1;
        }

        .message {
            font-size: 1.4rem;
            margin: 20px 0;
            min-height: 40px;
            color: #ffeb3b;
            text-shadow: 0 0 5px rgba(255, 235, 59, 0.7);
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .pulse {
            animation: pulse 0.6s ease-out;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
            }
            50% {
                transform: scale(1.1);
                box-shadow: 0 15px 30px rgba(255, 107, 107, 0.6);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
            }
        }

        .floating {
            position: absolute;
            animation: float 3s ease-in-out forwards;
            font-weight: bold;
            pointer-events: none;
            z-index: 100;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        @keyframes float {
            0% {
                transform: translateY(0) scale(0.8);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(1.2);
                opacity: 0;
            }
        }

        .achievement {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 215, 0, 0.9);
            color: #333;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 1000;
        }

        .achievement.show {
            opacity: 1;
        }

        .upgrades {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .upgrade {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 10px 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .upgrade:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .upgrade:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .theme-selector {
            margin-top: 20px;
        }

        .theme-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 8px 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 5px;
        }

        .theme-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .auto-clicker {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .settings-panel {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .settings-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: rotate(45deg);
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(to right, var(--tg-theme-button-color, #ff6b6b), #ff8e8e);
            border-radius: 5px;
            width: 0%;
            transition: width 0.5s ease;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--tg-theme-secondary-bg-color, rgba(30, 30, 30, 0.9));
            backdrop-filter: blur(12px);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--tg-theme-text-color, #ffffff);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
            color: var(--tg-theme-text-color, #ffffff);
        }

        .settings-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .settings-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .settings-slider {
            width: 100%;
            margin: 10px 0;
        }

        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }

        .user-details {
            text-align: left;
        }

        .user-name {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .user-id {
            opacity: 0.7;
            font-size: 0.9rem;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .achievement-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .achievement-item.locked {
            opacity: 0.5;
            filter: grayscale(1);
        }

        .achievement-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .achievement-title {
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .achievement-desc {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .shop-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .shop-category {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .shop-category.active {
            background: var(--tg-theme-button-color, #ff6b6b);
        }

        .shop-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .shop-item:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .shop-item-title {
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .shop-item-price {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .tab-container {
            display: none;
        }

        .tab-container.active {
            display: block;
        }

        .tab-buttons {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab-button {
            padding: 10px 15px;
            background: none;
            border: none;
            color: var(--tg-theme-text-color, #ffffff);
            cursor: pointer;
            font-weight: 500;
            opacity: 0.7;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }

        .tab-button.active {
            opacity: 1;
            border-bottom: 2px solid var(--tg-theme-button-color, #ff6b6b);
        }

        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 10;
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--tg-theme-bg-color, #6a11cb);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top: 5px solid var(--tg-theme-button-color, #ff6b6b);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 600px) {
            .title {
                font-size: 2.5rem;
            }

            .counter {
                font-size: 2.5rem;
            }

            .click-button {
                width: 140px;
                height: 140px;
                font-size: 1.4rem;
            }

            .container {
                padding: 30px 20px;
            }

            .message {
                font-size: 1.2rem;
            }

            .stats {
                flex-direction: column;
                gap: 15px;
            }

            .achievements-grid, .shop-items {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
    </div>

    <div class="container">
        <div class="settings-panel">
            <div class="settings-btn" id="settingsBtn">
                <i class="fas fa-cog"></i>
            </div>
        </div>

        <h1 class="title">–ê–≥–Ω–∏—è27</h1>
        <div class="counter" id="counter">0</div>
        <button class="click-button" id="clickButton">–ö–õ–ò–ö</button>
        <div class="message" id="message">–ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É!</div>

        <div class="progress-bar">
            <div class="progress" id="progress"></div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="clicksPerSecond">0</div>
                <div class="stat-label">–ö–ª–∏–∫–æ–≤/—Å–µ–∫</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="maxCPS">0</div>
                <div class="stat-label">–ú–∞–∫—Å. CPS</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalClicks">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤</div>
            </div>
        </div>

        <div class="auto-clicker">
            <div class="stat-label">–ê–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä: <span id="autoClickerLevel">0</span> —É—Ä.</div>
            <button class="upgrade" id="upgradeAutoClicker">–£–ª—É—á—à–∏—Ç—å (50 –∫–ª–∏–∫–æ–≤)</button>
        </div>

        <div class="upgrades">
            <button class="upgrade" id="upgradeMultiplier">–£–º–Ω–æ–∂–∏—Ç–µ–ª—å x2 (100 –∫–ª–∏–∫–æ–≤)</button>
            <button class="upgrade" id="upgradeClickPower">–°–∏–ª–∞ –∫–ª–∏–∫–∞ +1 (30 –∫–ª–∏–∫–æ–≤)</button>
        </div>

        <div class="tab-buttons">
            <button class="tab-button active" data-tab="main">–û—Å–Ω–æ–≤–Ω–æ–µ</button>
            <button class="tab-button" data-tab="upgrades">–£–ª—É—á—à–µ–Ω–∏—è</button>
            <button class="tab-button" data-tab="shop">–ú–∞–≥–∞–∑–∏–Ω</button>
            <button class="tab-button" data-tab="achievements">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
        </div>

        <div class="tab-container active" id="tab-main">
            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —É–∂–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ -->
        </div>

        <div class="tab-container" id="tab-upgrades">
            <div class="upgrades-grid">
                <button class="upgrade" data-upgrade="multiplier">–£–º–Ω–æ–∂–∏—Ç–µ–ª—å x2 (100 –∫–ª–∏–∫–æ–≤)</button>
                <button class="upgrade" data-upgrade="clickPower">–°–∏–ª–∞ –∫–ª–∏–∫–∞ +1 (30 –∫–ª–∏–∫–æ–≤)</button>
                <button class="upgrade" data-upgrade="autoClicker">–ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä (50 –∫–ª–∏–∫–æ–≤)</button>
                <button class="upgrade" data-upgrade="criticalChance">–®–∞–Ω—Å –∫—Ä–∏—Ç–∞ +5% (200 –∫–ª–∏–∫–æ–≤)</button>
                <button class="upgrade" data-upgrade="criticalMultiplier">–ú–Ω–æ–∂–∏—Ç–µ–ª—å –∫—Ä–∏—Ç–∞ x2 (300 –∫–ª–∏–∫–æ–≤)</button>
            </div>
        </div>

        <div class="tab-container" id="tab-shop">
            <div class="shop-categories">
                <div class="shop-category active" data-category="boosters">–ë—É—Å—Ç—ã</div>
                <div class="shop-category" data-category="skins">–°–∫–∏–Ω—ã</div>
                <div class="shop-category" data-category="special">–û—Å–æ–±—ã–µ</div>
            </div>
            <div class="shop-items" id="shop-items">
                <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <div class="tab-container" id="tab-achievements">
            <div class="achievements-grid" id="achievements-grid">
                <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <div class="achievement" id="achievement">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ!</div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <button class="modal-close" id="closeSettings">&times;</button>
            <h2 class="modal-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>

            <div class="user-info">
                <img src="" alt="–ê–≤–∞—Ç–∞—Ä" class="user-avatar" id="userAvatar">
                <div class="user-details">
                    <div class="user-name" id="userName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                    <div class="user-id" id="userId">ID: </div>
                </div>
            </div>

            <div class="settings-section">
                <h3>–ó–≤—É–∫</h3>
                <label class="settings-label">
                    <input type="checkbox" id="soundEnabled" checked> –í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫–∏
                </label>
                <label class="settings-label">
                    <input type="checkbox" id="musicEnabled" checked> –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞
                </label>
                <label class="settings-label">–ì—Ä–æ–º–∫–æ—Å—Ç—å:</label>
                <input type="range" min="0" max="100" value="80" class="settings-slider" id="volumeSlider">
            </div>

            <div class="settings-section">
                <h3>–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</h3>
                <label class="settings-label">
                    <input type="checkbox" id="darkTheme"> –¢–µ–º–Ω–∞—è —Ç–µ–º–∞
                </label>
                <label class="settings-label">
                    <input type="checkbox" id="particlesEnabled" checked> –ß–∞—Å—Ç–∏—Ü—ã –ø—Ä–∏ –∫–ª–∏–∫–∞—Ö
                </label>
            </div>

            <div class="settings-section">
                <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stat-item">
                    <div class="stat-label">–í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤:</div>
                    <div class="stat-value" id="statsTotalClicks">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">–ú–∞–∫—Å. CPS:</div>
                    <div class="stat-value" id="statsMaxCPS">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">–í—Ä–µ–º—è –∏–≥—Ä—ã:</div>
                    <div class="stat-value" id="statsPlayTime">0:00</div>
                </div>
            </div>

            <div class="settings-section">
                <h3>–î–µ–π—Å—Ç–≤–∏—è</h3>
                <button class="upgrade" id="exportData">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                <button class="upgrade" id="resetProgress">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
            </div>
        </div>
    </div>

    <!-- –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã -->
    <audio id="clickSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
    </audio>
    <audio id="achievementSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="upgradeSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" type="audio/mpeg">
    </audio>
    <audio id="backgroundMusic" loop preload="auto">
        <source src="https://assets.mixkit.co/music/preview/mixkit-game-show-suspense-waiting-667.mp3" type="audio/mpeg">
    </audio>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = window.Telegram.WebApp;

        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
        let count = 0;
        let totalClicks = 0;
        let clicksInLastSecond = 0;
        let maxCPS = 0;
        let clickPower = 1;
        let multiplier = 1;
        let autoClickerLevel = 0;
        let criticalChance = 0;
        let criticalMultiplier = 2;
        let playTime = 0;
        let cpsInterval;
        let autoClickerInterval;
        let playTimeInterval;

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        let settings = {
            sound: true,
            music: true,
            volume: 0.8,
            darkTheme: false,
            particles: true
        };

        // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
        let achievements = [
            { id: 'first_27', count: 27, title: '–ü–µ—Ä–≤—ã–µ 27 –∫–ª–∏–∫–æ–≤!', description: '–ù–∞–±–µ—Ä–∏—Ç–µ 27 –∫–ª–∏–∫–æ–≤', icon: 'ü•á', unlocked: false },
            { id: 'hundred', count: 100, title: '100 –∫–ª–∏–∫–æ–≤!', description: '–ù–∞–±–µ—Ä–∏—Ç–µ 100 –∫–ª–∏–∫–æ–≤', icon: 'üèÜ', unlocked: false },
            { id: 'five_hundred', count: 500, title: '500 –∫–ª–∏–∫–æ–≤! –ú–∞—Å—Ç–µ—Ä –∫–ª–∏–∫–∞!', description: '–ù–∞–±–µ—Ä–∏—Ç–µ 500 –∫–ª–∏–∫–æ–≤', icon: 'üëë', unlocked: false },
            { id: 'speed_5', cps: 5, title: '–°–∫–æ—Ä–æ—Å—Ç—å 5 –∫–ª–∏–∫–æ–≤/—Å–µ–∫!', description: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ 5 –∫–ª–∏–∫–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É', icon: '‚ö°', unlocked: false },
            { id: 'speed_10', cps: 10, title: '–ù–µ–≤–µ—Ä–æ—è—Ç–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å 10 –∫–ª–∏–∫–æ–≤/—Å–µ–∫!', description: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ 10 –∫–ª–∏–∫–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É', icon: 'üöÄ', unlocked: false },
            { id: 'first_upgrade', upgrade: true, title: '–ü–µ—Ä–≤–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ!', description: '–ö—É–ø–∏—Ç–µ –ø–µ—Ä–≤–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ', icon: 'üõ†Ô∏è', unlocked: false },
            { id: 'max_multiplier', multiplier: 10, title: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å!', description: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ –º–Ω–æ–∂–∏—Ç–µ–ª—è x10', icon: '‚ú®', unlocked: false }
        ];

        // –ú–∞–≥–∞–∑–∏–Ω
        let shopItems = {
            boosters: [
                { id: 'booster_30min', name: '–ë—É—Å—Ç x2 –Ω–∞ 30 –º–∏–Ω', price: 200, effect: { multiplier: 2 }, duration: 1800 },
                { id: 'booster_1h', name: '–ë—É—Å—Ç x2 –Ω–∞ 1 —á–∞—Å', price: 350, effect: { multiplier: 2 }, duration: 3600 },
                { id: 'booster_4h', name: '–ë—É—Å—Ç x3 –Ω–∞ 4 —á–∞—Å–∞', price: 800, effect: { multiplier: 3 }, duration: 14400 }
            ],
            skins: [
                { id: 'skin_gold', name: '–ó–æ–ª–æ—Ç–∞—è –∫–Ω–æ–ø–∫–∞', price: 1000, effect: { skin: 'gold' } },
                { id: 'skin_diamond', name: '–ê–ª–º–∞–∑–Ω–∞—è –∫–Ω–æ–ø–∫–∞', price: 5000, effect: { skin: 'diamond' } }
            ],
            special: [
                { id: 'special_100clicks', name: '–ê–≤—Ç–æ–∫–ª–∏–∫ –Ω–∞ 100 –∫–ª–∏–∫–æ–≤', price: 1500, effect: { autoClick: 100 } },
                { id: 'special_mystery', name: '–¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—É–Ω–¥—É–∫', price: 3000, effect: { random: true } }
            ]
        };

        // –ê–∫—Ç–∏–≤–Ω—ã–µ –±—É—Å—Ç—ã
        let activeBoosters = [];

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const counterElement = document.getElementById('counter');
        const clickButton = document.getElementById('clickButton');
        const messageElement = document.getElementById('message');
        const cpsElement = document.getElementById('clipsPerSecond');
        const maxCPSElement = document.getElementById('maxCPS');
        const totalClicksElement = document.getElementById('totalClicks');
        const achievementElement = document.getElementById('achievement');
        const progressElement = document.getElementById('progress');
        const upgradeMultiplierBtn = document.getElementById('upgradeMultiplier');
        const upgradeClickPowerBtn = document.getElementById('upgradeClickPower');
        const upgradeAutoClickerBtn = document.getElementById('upgradeAutoClicker');
        const autoClickerLevelElement = document.getElementById('autoClickerLevel');
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsModal = document.getElementById('settingsModal');
        const closeSettingsBtn = document.getElementById('closeSettings');
        const loadingElement = document.getElementById('loading');
        const userAvatarElement = document.getElementById('userAvatar');
        const userNameElement = document.getElementById('userName');
        const userIdElement = document.getElementById('userId');
        const soundEnabledCheckbox = document.getElementById('soundEnabled');
        const musicEnabledCheckbox = document.getElementById('musicEnabled');
        const volumeSlider = document.getElementById('volumeSlider');
        const darkThemeCheckbox = document.getElementById('darkTheme');
        const particlesCheckbox = document.getElementById('particlesEnabled');
        const statsTotalClicksElement = document.getElementById('statsTotalClicks');
        const statsMaxCPSElement = document.getElementById('statsMaxCPS');
        const statsPlayTimeElement = document.getElementById('statsPlayTime');
        const exportDataBtn = document.getElementById('exportData');
        const resetProgressBtn = document.getElementById('resetProgress');
        const achievementsGrid = document.getElementById('achievements-grid');
        const shopItemsContainer = document.getElementById('shop-items');
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContainers = document.querySelectorAll('.tab-container');

        // –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã
        const clickSound = document.getElementById('clickSound');
        const achievementSound = document.getElementById('achievementSound');
        const upgradeSound = document.getElementById('upgradeSound');
        const backgroundMusic = document.getElementById('backgroundMusic');

        // –°–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –ø—Ä–∏ –∫–ª–∏–∫–µ
        const messages = ["–ê–≥–Ω–∏—è", "27", "–ê–≥–Ω–∏—è27", "–ê–≥–Ω–∏—è, –ê–≥–Ω–∏—è!", "27 –ê–≥–Ω–∏—è", "–ê–≥–Ω–∏—è 27 27", "27 27 27!"];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
            tg.expand();
            tg.enableClosingConfirmation();

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            loadUserData();

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            loadGameProgress();

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
            initCPS();
            initAutoClicker();
            initPlayTime();

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            updateUI();

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
            renderAchievements();

            // –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞
            renderShopItems('boosters');

            // –°–∫—Ä—ã—Ç–∏–µ —ç–∫—Ä–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏
            setTimeout(() => {
                loadingElement.style.opacity = '0';
                setTimeout(() => {
                    loadingElement.style.display = 'none';
                }, 500);
            }, 1000);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
        function loadUserData() {
            const user = tg.initDataUnsafe?.user;
            if (user) {
                userNameElement.textContent = `${user.first_name || ''} ${user.last_name || ''}`.trim() || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                userIdElement.textContent = `ID: ${user.id}`;

                if (user.photo_url) {
                    userAvatarElement.src = user.photo_url;
                } else {
                    userAvatarElement.style.display = 'none';
                }
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–≥—Ä—ã –∏–∑ Telegram Cloud Storage
        function loadGameProgress() {
            tg.CloudStorage.getKeys((error, keys) => {
                if (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', error);
                    return;
                }

                if (keys && keys.length > 0) {
                    tg.CloudStorage.getItems(keys, (error, data) => {
                        if (error) {
                            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                            return;
                        }

                        if (data) {
                            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                            if (data.count) count = parseInt(data.count);
                            if (data.totalClicks) totalClicks = parseInt(data.totalClicks);
                            if (data.clickPower) clickPower = parseInt(data.clickPower);
                            if (data.multiplier) multiplier = parseInt(data.multiplier);
                            if (data.autoClickerLevel) autoClickerLevel = parseInt(data.autoClickerLevel);
                            if (data.criticalChance) criticalChance = parseInt(data.criticalChance);
                            if (data.criticalMultiplier) criticalMultiplier = parseInt(data.criticalMultiplier);
                            if (data.maxCPS) maxCPS = parseInt(data.maxCPS);
                            if (data.playTime) playTime = parseInt(data.playTime);

                            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
                            if (data.settings) {
                                try {
                                    const savedSettings = JSON.parse(data.settings);
                                    settings = { ...settings, ...savedSettings };

                                    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
                                    soundEnabledCheckbox.checked = settings.sound;
                                    musicEnabledCheckbox.checked = settings.music;
                                    volumeSlider.value = settings.volume * 100;
                                    darkThemeCheckbox.checked = settings.darkTheme;
                                    particlesCheckbox.checked = settings.particles;

                                    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã
                                    if (settings.darkTheme) {
                                        document.body.classList.add('dark-theme');
                                    }

                                    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
                                    setVolume(settings.volume);

                                    // –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –º—É–∑—ã–∫–∏
                                    if (settings.music) {
                                        backgroundMusic.play().catch(e => console.log("–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º—É–∑—ã–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ"));
                                    }
                                } catch (e) {
                                    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', e);
                                }
                            }

                            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
                            if (data.achievements) {
                                try {
                                    const savedAchievements = JSON.parse(data.achievements);
                                    achievements = achievements.map(ach => {
                                        const saved = savedAchievements.find(a => a.id === ach.id);
                                        return saved ? { ...ach, ...saved } : ach;
                                    });
                                } catch (e) {
                                    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π:', e);
                                }
                            }

                            updateUI();
                        }
                    });
                }
            });
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–≥—Ä—ã –≤ Telegram Cloud Storage
        function saveGameProgress() {
            const data = {
                count: count.toString(),
                totalClicks: totalClicks.toString(),
                clickPower: clickPower.toString(),
                multiplier: multiplier.toString(),
                autoClickerLevel: autoClickerLevel.toString(),
                criticalChance: criticalChance.toString(),
                criticalMultiplier: criticalMultiplier.toString(),
                maxCPS: maxCPS.toString(),
                playTime: playTime.toString(),
                settings: JSON.stringify(settings),
                achievements: JSON.stringify(achievements)
            };

            tg.CloudStorage.setItems(data, (error) => {
                if (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                }
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥—Å—á–µ—Ç–∞ –∫–ª–∏–∫–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
        function initCPS() {
            let lastClicks = totalClicks;

            cpsInterval = setInterval(() => {
                clicksInLastSecond = totalClicks - lastClicks;
                lastClicks = totalClicks;

                if (clicksInLastSecond > maxCPS) {
                    maxCPS = clicksInLastSecond;
                }

                updateUI();
                checkAchievements();
            }, 1000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞
        function initAutoClicker() {
            if (autoClickerInterval) {
                clearInterval(autoClickerInterval);
            }

            if (autoClickerLevel > 0) {
                autoClickerInterval = setInterval(() => {
                    const autoClicks = autoClickerLevel;
                    addClicks(autoClicks);
                }, 1000);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–µ—Ä–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        function initPlayTime() {
            playTimeInterval = setInterval(() => {
                playTime++;

                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
                if (playTime % 60 === 0) {
                    updateSettingsUI();
                }
            }, 1000);
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–∫–æ–≤
        function addClicks(amount) {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä
            let isCritical = false;
            if (Math.random() < criticalChance / 100) {
                amount *= criticalMultiplier;
                isCritical = true;
            }

            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–Ω–æ–∂–∏—Ç–µ–ª—è
            const addedCount = Math.floor(amount * multiplier);
            count += addedCount;
            totalClicks += amount;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            updateUI();

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            saveGameProgress();

            // –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            if (isCritical) {
                showCriticalEffect(amount);
            } else {
                showClickEffect(amount);
            }

            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞
            playSound(clickSound);

            // –í–∏–±—Ä–æ–æ—Ç–∫–ª–∏–∫
            tg.HapticFeedback.impactOccurred('light');
        }

        // –ü–æ–∫—É–ø–∫–∞ —É–ª—É—á—à–µ–Ω–∏—è
        function buyUpgrade(type, cost) {
            if (count >= cost) {
                count -= cost;

                switch (type) {
                    case 'multiplier':
                        multiplier *= 2;
                        break;
                    case 'clickPower':
                        clickPower += 1;
                        break;
                    case 'autoClicker':
                        autoClickerLevel += 1;
                        initAutoClicker();
                        break;
                    case 'criticalChance':
                        criticalChance += 5;
                        break;
                    case 'criticalMultiplier':
                        criticalMultiplier *= 2;
                        break;
                }

                // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞
                playSound(upgradeSound);

                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                saveGameProgress();

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
                updateUI();

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
                checkAchievements();

                return true;
            }

            return false;
        }

        // –ü–æ–∫—É–ø–∫–∞ —Ç–æ–≤–∞—Ä–∞ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
        function buyShopItem(item) {
            if (count >= item.price) {
                count -= item.price;

                // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ —Ç–æ–≤–∞—Ä–∞
                if (item.effect.multiplier) {
                    // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –±—É—Å—Ç–∞
                    const booster = {
                        effect: item.effect,
                        expires: Date.now() + (item.duration * 1000)
                    };
                    activeBoosters.push(booster);
                    applyBoosters();

                    // –¢–∞–π–º–µ—Ä –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –±—É—Å—Ç–∞
                    setTimeout(() => {
                        activeBoosters = activeBoosters.filter(b => b !== booster);
                        applyBoosters();
                        updateUI();
                    }, item.duration * 1000);
                }

                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                saveGameProgress();

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
                updateUI();

                return true;
            }

            return false;
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—É—Å—Ç–æ–≤
        function applyBoosters() {
            let totalMultiplier = 1;

            activeBoosters.forEach(booster => {
                totalMultiplier *= booster.effect.multiplier;
            });

            multiplier = totalMultiplier;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        function checkAchievements() {
            achievements.forEach(achievement => {
                if (!achievement.unlocked) {
                    let unlocked = false;

                    if (achievement.count && totalClicks >= achievement.count) {
                        unlocked = true;
                    }

                    if (achievement.cps && maxCPS >= achievement.cps) {
                        unlocked = true;
                    }

                    if (achievement.upgrade && autoClickerLevel > 0) {
                        unlocked = true;
                    }

                    if (achievement.multiplier && multiplier >= achievement.multiplier) {
                        unlocked = true;
                    }

                    if (unlocked) {
                        achievement.unlocked = true;
                        showAchievement(achievement);
                        saveGameProgress();
                    }
                }
            });
        }

        // –ü–æ–∫–∞–∑ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
        function showAchievement(achievement) {
            achievementElement.textContent = `${achievement.icon} ${achievement.title}`;
            achievementElement.classList.add('show');

            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞
            playSound(achievementSound);

            // –í–∏–±—Ä–æ–æ—Ç–∫–ª–∏–∫
            tg.HapticFeedback.notificationOccurred('success');

            setTimeout(() => {
                achievementElement.classList.remove('show');
            }, 3000);
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ –∫–ª–∏–∫–∞
        function showClickEffect(amount) {
            if (!settings.particles) return;

            const effect = document.createElement('div');
            effect.className = 'floating';
            effect.textContent = `+${amount}`;
            effect.style.left = `${Math.random() * 80 + 10}%`;
            effect.style.color = '#ffffff';

            document.body.appendChild(effect);

            setTimeout(() => {
                document.body.removeChild(effect);
            }, 3000);
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞—Ä–∞
        function showCriticalEffect(amount) {
            if (!settings.particles) return;

            const effect = document.createElement('div');
            effect.className = 'floating';
            effect.textContent = `–ö–†–ò–¢! +${amount}`;
            effect.style.left = `${Math.random() * 80 + 10}%`;
            effect.style.color = '#ffeb3b';
            effect.style.fontSize = '1.5rem';

            document.body.appendChild(effect);

            // –í–∏–±—Ä–æ–æ—Ç–∫–ª–∏–∫
            tg.HapticFeedback.impactOccurred('heavy');

            setTimeout(() => {
                document.body.removeChild(effect);
            }, 3000);
        }

        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞
        function playSound(soundElement) {
            if (!settings.sound) return;

            soundElement.currentTime = 0;
            soundElement.volume = settings.volume;
            soundElement.play().catch(e => console.log("–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ"));
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        function setVolume(volume) {
            settings.volume = volume;

            clickSound.volume = volume;
            achievementSound.volume = volume;
            upgradeSound.volume = volume;
            backgroundMusic.volume = volume * 0.7;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤
            counterElement.textContent = formatNumber(count);
            cpsElement.textContent = clicksInLastSecond;
            maxCPSElement.textContent = maxCPS;
            totalClicksElement.textContent = formatNumber(totalClicks);
            autoClickerLevelElement.textContent = autoClickerLevel;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
            const nextUpgrade = Math.max(50, 100, 30);
            const progress = Math.min((count / nextUpgrade) * 100, 100);
            progressElement.style.width = `${progress}%`;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —É–ª—É—á—à–µ–Ω–∏–π
            upgradeMultiplierBtn.disabled = count < 100;
            upgradeClickPowerBtn.disabled = count < 30;
            upgradeAutoClickerBtn.disabled = count < 50;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–æ–∫ —É–ª—É—á—à–µ–Ω–∏–π
            upgradeMultiplierBtn.textContent = `–£–º–Ω–æ–∂–∏—Ç–µ–ª—å x${multiplier * 2} (${formatNumber(100 * Math.pow(2, Math.log2(multiplier)))})`;
            upgradeClickPowerBtn.textContent = `–°–∏–ª–∞ –∫–ª–∏–∫–∞ +1 (${formatNumber(30 + clickPower * 10)})`;
            upgradeAutoClickerBtn.textContent = `–£–ª—É—á—à–∏—Ç—å (${formatNumber(50 + autoClickerLevel * 50)})`;

            // –°–ª—É—á–∞–π–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (clicksInLastSecond > 0 && Math.random() < 0.1) {
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                messageElement.textContent = randomMessage;

                setTimeout(() => {
                    messageElement.textContent = '';
                }, 2000);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function updateSettingsUI() {
            statsTotalClicksElement.textContent = formatNumber(totalClicks);
            statsMaxCPSElement.textContent = maxCPS;

            const minutes = Math.floor(playTime / 60);
            const seconds = playTime % 60;
            statsPlayTimeElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        function renderAchievements() {
            achievementsGrid.innerHTML = '';

            achievements.forEach(achievement => {
                const achievementElement = document.createElement('div');
                achievementElement.className = `achievement-item ${achievement.unlocked ? '' : 'locked'}`;

                achievementElement.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-title">${achievement.title}</div>
                    <div class="achievement-desc">${achievement.description}</div>
                `;

                achievementsGrid.appendChild(achievementElement);
            });
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –º–∞–≥–∞–∑–∏–Ω–∞
        function renderShopItems(category) {
            shopItemsContainer.innerHTML = '';

            const items = shopItems[category];

            items.forEach(item => {
                const itemElement = document.createElement('button');
                itemElement.className = 'shop-item';
                itemElement.disabled = count < item.price;

                itemElement.innerHTML = `
                    <div class="shop-item-title">${item.name}</div>
                    <div class="shop-item-price">${formatNumber(item.price)} –∫–ª–∏–∫–æ–≤</div>
                `;

                itemElement.addEventListener('click', () => {
                    if (buyShopItem(item)) {
                        renderShopItems(category);
                    }
                });

                shopItemsContainer.appendChild(itemElement);
            });
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª (1000 -> 1K)
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∏–∫
            clickButton.addEventListener('click', () => {
                addClicks(clickPower);
                clickButton.classList.add('pulse');
                setTimeout(() => {
                    clickButton.classList.remove('pulse');
                }, 300);
            });

            // –£–ª—É—á—à–µ–Ω–∏—è
            upgradeMultiplierBtn.addEventListener('click', () => {
                const cost = 100 * Math.pow(2, Math.log2(multiplier));
                if (buyUpgrade('multiplier', cost)) {
                    updateUI();
                }
            });

            upgradeClickPowerBtn.addEventListener('click', () => {
                const cost = 30 + clickPower * 10;
                if (buyUpgrade('clickPower', cost)) {
                    updateUI();
                }
            });

            upgradeAutoClickerBtn.addEventListener('click', () => {
                const cost = 50 + autoClickerLevel * 50;
                if (buyUpgrade('autoClicker', cost)) {
                    updateUI();
                }
            });

            // –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
            settingsBtn.addEventListener('click', () => {
                updateSettingsUI();
                settingsModal.classList.add('active');
            });

            closeSettingsBtn.addEventListener('click', () => {
                settingsModal.classList.remove('active');
            });

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–∞
            soundEnabledCheckbox.addEventListener('change', () => {
                settings.sound = soundEnabledCheckbox.checked;
                saveGameProgress();
            });

            musicEnabledCheckbox.addEventListener('change', () => {
                settings.music = musicEnabledCheckbox.checked;

                if (settings.music) {
                    backgroundMusic.play().catch(e => console.log("–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º—É–∑—ã–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ"));
                } else {
                    backgroundMusic.pause();
                }

                saveGameProgress();
            });

            volumeSlider.addEventListener('input', () => {
                const volume = volumeSlider.value / 100;
                setVolume(volume);
                settings.volume = volume;
                saveGameProgress();
            });

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã
            darkThemeCheckbox.addEventListener('change', () => {
                settings.darkTheme = darkThemeCheckbox.checked;

                if (settings.darkTheme) {
                    document.body.classList.add('dark-theme');
                } else {
                    document.body.classList.remove('dark-theme');
                }

                saveGameProgress();
            });

            particlesCheckbox.addEventListener('change', () => {
                settings.particles = particlesCheckbox.checked;
                saveGameProgress();
            });

            // –î–µ–π—Å—Ç–≤–∏—è
            exportDataBtn.addEventListener('click', () => {
                const data = JSON.stringify({
                    count,
                    totalClicks,
                    clickPower,
                    multiplier,
                    autoClickerLevel,
                    criticalChance,
                    criticalMultiplier,
                    maxCPS,
                    playTime,
                    achievements: achievements.filter(a => a.unlocked).map(a => a.title)
                }, null, 2);

                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = 'agnia27_save.json';
                a.click();

                URL.revokeObjectURL(url);
            });

            resetProgressBtn.addEventListener('click', () => {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                    // –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                    count = 0;
                    totalClicks = 0;
                    clickPower = 1;
                    multiplier = 1;
                    autoClickerLevel = 0;
                    criticalChance = 0;
                    criticalMultiplier = 2;
                    maxCPS = 0;
                    playTime = 0;

                    // –°–±—Ä–æ—Å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
                    achievements.forEach(a => a.unlocked = false);

                    // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞
                    initAutoClicker();

                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
                    updateUI();
                    renderAchievements();

                    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
                    saveGameProgress();

                    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    tg.showPopup({
                        title: '–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω',
                        message: '–í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ —É—Å–ø–µ—à–Ω–æ —Å–±—Ä–æ—à–µ–Ω—ã.',
                        buttons: [{ type: 'ok' }]
                    });
                }
            });

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.getAttribute('data-tab');

                    // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∫–ª–∞–¥–∫–∏
                    tabContainers.forEach(tab => tab.classList.remove('active'));
                    document.getElementById(`tab-${tabId}`).classList.add('active');

                    // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ –≤–∫–ª–∞–¥–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞, –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã
                    if (tabId === 'shop') {
                        const activeCategory = document.querySelector('.shop-category.active').getAttribute('data-category');
                        renderShopItems(activeCategory);
                    }
                });
            });

            // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞
            document.querySelectorAll('.shop-category').forEach(category => {
                category.addEventListener('click', () => {
                    document.querySelectorAll('.shop-category').forEach(c => c.classList.remove('active'));
                    category.classList.add('active');

                    const categoryName = category.getAttribute('data-category');
                    renderShopItems(categoryName);
                });
            });

            // –£–ª—É—á—à–µ–Ω–∏—è –≤–æ –≤–∫–ª–∞–¥–∫–µ
            document.querySelectorAll('.upgrade[data-upgrade]').forEach(upgrade => {
                upgrade.addEventListener('click', () => {
                    const type = upgrade.getAttribute('data-upgrade');
                    let cost = 0;

                    switch (type) {
                        case 'multiplier':
                            cost = 100 * Math.pow(2, Math.log2(multiplier));
                            break;
                        case 'clickPower':
                            cost = 30 + clickPower * 10;
                            break;
                        case 'autoClicker':
                            cost = 50 + autoClickerLevel * 50;
                            break;
                        case 'criticalChance':
                            cost = 200;
                            break;
                        case 'criticalMultiplier':
                            cost = 300;
                            break;
                    }

                    if (buyUpgrade(type, cost)) {
                        updateUI();
                    }
                });
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initGame);

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–∞—É–∑–∞ –º—É–∑—ã–∫–∏ –ø—Ä–∏ —Å–∫—Ä—ã—Ç–∏–∏)
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                backgroundMusic.pause();
            } else if (settings.music) {
                backgroundMusic.play().catch(e => console.log("–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º—É–∑—ã–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ"));
            }
        });
    </script>
</body>
</html>